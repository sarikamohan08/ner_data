import pandas as pd

# Define the complete field structure
REQUIRED_FIELDS = {
    'PROVIDER_NAME': None,
    'EFFECTIVE_FROM_DATE': None,
    'NPI': None,
    'TAX_ID': None,
    'SERVICE_TYPE': None,
    'SERVICES': None,
    'SERVICE_DESC': None,
    'REIMBURSEMENT_AMT': None,
    'REIMBURSEMENT_RATE': None,
    'REIMBURSEMENT_METHODOLOGY': None,
    'CODES': None,
    'METHOD_OF_PAYMENT': None,
    'REVENUE_CD_IND': 0,
    'DRG_CD_IND': 0,
    'CPT_IND': 0,
    'HCPCS_IND': 0,
    'ICD_CD_IND': 0,
    'DIAGNOSIS_CD_IND': 0,
    'MODIFIER_CD_IND': 0,
    'LOB_IND': None,
    'AGE_GROUP': 0,
    'GROUPER_IND': 0,
    'GROUPER': None,
    'APC_IND': 0,
    'MSR_IND': 0,
    'BILATERAL_PROCEDURE_IND': 0,
    'PROVIDER_SPECIALTY': 0,
    'EXCLUDE_FROM_TRANSFER_IND': 0,
    'TRANSFER_CALCULATION': None,
    'EXCLUDE_FROM_STOPLOSS_IND': 0,
    'OTHER_FLAT_FEE': 0,
    'SURG_FLAT_FEE': 0,
    'CASE_RATE': None,
    'HEALTH_BENEFIT_PLANS': None
}

def fix_missing_fields(combined_data):
    """Ensure every record has all required fields"""
    fixed_data = []
    for record in combined_data:
        fixed_record = REQUIRED_FIELDS.copy()
        fixed_record.update(record)  # This adds any fields the AI provided
        fixed_data.append(fixed_record)
    return fixed_data

# Usage:
# combined_data = [...]  # Your AI output
# safe_data = fix_missing_fields(combined_data)

# Convert to DataFrame safely
df = pd.DataFrame(fix_missing_fields(combined_data))
