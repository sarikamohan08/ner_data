import re
import os
import pandas as pd

# Define the regular expression pattern for dates and the specific full titles
date_pattern = r'(?:effective date of|commence on)\s*(\d{1,2}[./]\d{1,2}[./]\d{2,4}|\w+\s\d{1,2},\s\d{4})'
title_pattern = r'(?i)(facility participation agreement|' \
                r'ancillary participation agreement|' \
                r'ambulatory surgery center provider participation agreement|' \
                r'physician and ancillary participation agreement|' \
                r'group participation agreement|' \
                r'physician participation agreement|' \
                r'request for taxpayer|' \
                r'humana\s+physician participation agreement|' \
                r'umana\s+physician participation agreement|' \
                r'OSF Healthplans participating specialist physician agreement|' \
                r'humana ancillary participation agreement)'

# Define the path to the folder containing text files
folder_path = 'path_to_your_folder'  # Replace this with your folder path

# List to store data for the Excel sheet
data = []

# Iterate through all text files in the folder
for filename in os.listdir(folder_path):
    if filename.endswith('.txt'):  # Process only .txt files
        file_path = os.path.join(folder_path, filename)

        # Open and read the contents of the file
        with open(file_path, 'r', encoding='utf-8') as file:
            text = file.read()

            # Find all date matches in the text
            date_matches = re.findall(date_pattern, text, re.IGNORECASE)

            # Find all full title matches in the text
            title_matches = re.findall(title_pattern, text, re.IGNORECASE)

            # Append file name, matched titles, and dates to the data list
            if date_matches or title_matches:
                for date in date_matches:
                    for title in title_matches:
                        data.append([filename, title.strip(), date])
                if not date_matches and title_matches:  # If only title exists
                    for title in title_matches:
                        data.append([filename, title.strip(), None])
                if not title_matches and date_matches:  # If only date exists
                    for date in date_matches:
                        data.append([filename, None, date])

# Convert the data into a pandas DataFrame
df = pd.DataFrame(data, columns=['File Name', 'Extracted Title', 'Extracted Date'])

# Write the DataFrame to an Excel file
output_file = 'extracted_specific_titles_and_dates.xlsx'  # Output Excel file name
df.to_excel(output_file, index=False, engine='openpyxl')

print(f"Extracted specific titles and dates have been written to {output_file}")
