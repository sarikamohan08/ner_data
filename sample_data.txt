import textract  # For DOC/DOCX files
import win32com.client as win32  # For DOC to DOCX conversio

def convert_doc_to_docx(doc_path):
    """Converts a .doc file to .docx"""
    word = win32.Dispatch("Word.Application")
    doc = word.Documents.Open(doc_path)
    
    # Create new .docx path
    docx_path = doc_path.replace(".doc", ".docx")
    
    # Save as .docx
    doc.SaveAs(docx_path, FileFormat=16)  # 16 = .docx format
    doc.Close()
    word.Quit()
    return docx_path

def extract_text_from_doc(doc_path):
    # Automatically convert .doc to .docx
    if doc_path.lower().endswith(".doc"):
        print(f"Converting {doc_path} to .docx...")
        doc_path = convert_doc_to_docx(doc_path)

    try:
        text = textract.process(doc_path).decode("utf-8")
    except Exception as e:
        print(f"Error extracting text from {doc_path}: {e}")
        text = ""
    return text
