import pandas as pd

def add_ccm_to_reply_sheet(filename):
    # Check if 'reply' is in the filename (case-insensitive)
    if "reply" in filename.casefold():
        try:
            # Read all sheets into a dictionary
            xls = pd.read_excel(filename, sheet_name=None, engine='openpyxl')

            updated_sheets = {}
            sheet_found = False

            # Loop through all sheets
            for sheet_name, df in xls.items():
                # Check if the sheet name is 'ocr output reply' (case-insensitive)
                if sheet_name.casefold() == "ocr output reply":
                    df['CCM'] = ""  # Add blank 'CCM' column
                    sheet_found = True
                    print(f"'CCM' column added to sheet: {sheet_name}")
                updated_sheets[sheet_name] = df

            if not sheet_found:
                print("No sheet named 'ocr output reply' found (case-insensitive match).")

            # Write all sheets back to the Excel file
            with pd.ExcelWriter(filename, engine='openpyxl') as writer:
                for sheet_name, df in updated_sheets.items():
                    df.to_excel(writer, sheet_name=sheet_name, index=False)

            print(f"✅ File updated: {filename}")
        
        except Exception as e:
            print(f"❌ Error processing file: {e}")
    else:
        print(f"ℹ️ Skipped: 'reply' not found in filename '{filename}'")

# ==== Example Usage ====
# Replace with your actual Excel filename
add_ccm_to_reply_sheet("Customer_OCR_OUTPUT_REPLY.xlsx")
