def extract_tables_from_pdf(pdf_path):
    tables_by_page = {}
    try:
        tables = camelot.read_pdf(pdf_path, pages='all', flavor='lattice')
        for table in tables:
            page_num = table.page
            if page_num not in tables_by_page:
                tables_by_page[page_num] = []
            tables_by_page[page_num].append(table.df.to_string(index=False))
    except Exception as e:
        print(f"[!] Error extracting tables: {e}")
    return tables_by_page

# --- Merge text and tables ---
def merge_text_and_tables(pages, tables_by_page):
    for page in pages:
        page_num = page['page']
        if page_num in tables_by_page:
            page['tables'] = tables_by_page[page_num]
    return pages
tables_by_page = extract_tables_from_pdf(pdf_path)
    merged_pages = merge_text_and_tables(pages, tables_by_page)
