import fitz  # PyMuPDF
import openai
import time

openai.api_key = "YOUR_OPENAI_API_KEY"  # Replace with your key

def extract_text_from_pdf(pdf_path):
    doc = fitz.open(pdf_path)
    return [page.get_text().strip() for page in doc if page.get_text().strip()]

def embed_texts(texts, model="text-embedding-3-small"):
    vectors = []
    for text in texts:
        try:
            response = openai.embeddings.create(input=text, model=model)
            vectors.append(response.data[0].embedding)
        except Exception as e:
            print(f"Error: {e}")
            vectors.append([])
        time.sleep(0.5)
    return vectors

def save_embeddings(embeddings, path='embeddings.txt'):
    with open(path, 'w') as f:
        for vec in embeddings:
            f.write(' '.join(map(str, vec)) + '\n')

def save_texts(texts, path='texts.txt'):
    with open(path, 'w') as f:
        for text in texts:
            f.write(text.replace('\n', ' ') + '\n')

if __name__ == "__main__":
    pdf_path = "your_file.pdf"  # Replace with your file
    texts = extract_text_from_pdf(pdf_path)
    embeddings = embed_texts(texts)
    save_embeddings(embeddings)
    save_texts(texts)
    print("âœ… Saved 'embeddings.txt' and 'texts.txt'")
