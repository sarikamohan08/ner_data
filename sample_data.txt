pages = convert_from_path(pdf_path, dpi=200)

# Step 2: Loop through pages, send images to GPT-4o
full_output = ""  # This will hold the final combined output

for i, page_image in enumerate(pages):
    print(f"Processing Page {i + 1}...")

    # Convert PIL image to byte stream
    img_byte_arr = io.BytesIO()
    page_image.save(img_byte_arr, format='PNG')
    img_byte_arr.seek(0)

    # Upload image to OpenAI
    file_response = openai.files.create(
        file=img_byte_arr,
        purpose="vision"
    )
    image_file_id = file_response["id"]

    # Ask GPT-4o to extract content
    response = openai.chat.completions.create(
        model="gpt-4o",
        messages=[
            {
                "role": "system",
                "content": "You are an expert at extracting structured content from scanned documents. Extract all text and tables in Markdown format."
            },
            {
                "role": "user",
                "content": [
                    {
                        "type": "image_url",
                        "image_url": {
                            "file_id": image_file_id,
                            "detail": "high"
                        }
                    }
                ]
            }
        ]
    )

    page_content = response.choices[0].message.content
    full_output += f"\n\n--- Page {i + 1} ---\n\n{page_content}"
