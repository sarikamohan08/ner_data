# Step 1: Filter 'payment basis' rows and create a multi-key dict
payment_basis_df = df[df['service'] == 'payment basis']
rate_dict = {
    (row['provider_name'], row['healthplan']): row['rate']
    for _, row in payment_basis_df.iterrows()
}

# Step 2: Define a function to fetch rate based on (provider_name, healthplan)
def get_rate(row):
    if row['service'] == 'catastrophic threshold':
        return rate_dict.get((row['provider_name'], row['healthplan']), row['rate'])
    return row['rate']  # Leave other rows unchanged

# Step 3: Apply function to the DataFrame
df['rate'] = df.apply(get_rate, axis=1)
