import os
import camelot
import pandas as pd

# Define the path to the folder containing PDFs
folder_path = 'path_to_your_folder_of_pdfs'
output_folder = 'path_to_save_excel_files'  # Folder to save Excel files

# Ensure the output folder exists
if not os.path.exists(output_folder):
    os.makedirs(output_folder)

# Loop through each file in the folder
for file_name in os.listdir(folder_path):
    if file_name.endswith('.pdf'):  # Process only PDF files
        # Get the full path to the PDF file
        pdf_path = os.path.join(folder_path, file_name)

        # Extract tables from the PDF
        tables = camelot.read_pdf(pdf_path, pages='all', flavor='lattice')  # Or use 'stream'

        # Initialize a list to store the DataFrames for this PDF
        df_list = []

        # Check if any tables were extracted
        if len(tables) == 0:
            print(f"No tables found in {file_name}.")
            continue  # Skip this file and move to the next PDF

        # Loop through extracted tables and add to the DataFrame list
        for i, table in enumerate(tables):
            df = table.df
            if not df.empty:
                df_list.append(df)
            else:
                print(f"Table {i + 1} in {file_name} is empty and will be skipped.")

        # If valid tables exist, concatenate and write to Excel
        if len(df_list) > 0:
            # Concatenate all DataFrames for this PDF
            combined_df = pd.concat(df_list, ignore_index=True)

            # Define the path to save the Excel file (using the PDF name as the Excel name)
            excel_file_name = os.path.splitext(file_name)[0] + '.xlsx'
            excel_path = os.path.join(output_folder, excel_file_name)

            # Save to Excel
            combined_df.to_excel(excel_path, sheet_name='All_Tables', index=False)
            print(f"Tables from {file_name} have been saved to {excel_file_name}.")
        else:
            print(f"No valid tables to save for {file_name}.")
