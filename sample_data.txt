import fitz  # PyMuPDF
import openai
import time

openai.api_key = "YOUR_OPENAI_API_KEY"  # Replace with your API key

# Extract text from PDF pages
def extract_text_from_pdf(pdf_path):
    doc = fitz.open(pdf_path)
    texts = [page.get_text().strip() for page in doc if page.get_text().strip()]
    return texts

# Embed using OpenAI's text-embedding-3-small model
def embed_texts_openai(texts, model="text-embedding-3-small"):
    embeddings = []
    for text in texts:
        try:
            response = openai.embeddings.create(
                input=text,
                model=model
            )
            vector = response.data[0].embedding
            embeddings.append(vector)
        except Exception as e:
            print(f"Error embedding text: {e}")
            embeddings.append([])
        time.sleep(0.5)  # Be kind to the API (adjust if needed)
    return embeddings

# Save embeddings to text file
def save_embeddings(embeddings, output_path='embeddings.txt'):
    with open(output_path, 'w') as f:
        for vec in embeddings:
            if vec:  # skip empty embeddings
                f.write(' '.join(map(str, vec)) + '\n')

# Run it
pdf_path = 'your_file.pdf'  # Replace with actual file
texts = extract_text_from_pdf(pdf_path)
embeddings = embed_texts_openai(texts)
save_embeddings(embeddings)

print("âœ… Embeddings saved to 'embeddings.txt'")
