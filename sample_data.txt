import difflib
import pandas as pd

def run_queries_with_gpt(queries_dict):
    texts = load_texts()  # list of text strings
    results = []

    for field, query in queries_dict.items():
        # Find the most similar text based on fuzzy matching
        top_match = max(texts, key=lambda t: difflib.SequenceMatcher(None, query, t).ratio())
        score = difflib.SequenceMatcher(None, query, top_match).ratio()

        # Ask GPT to extract the value from that text
        extracted_value = ask_gpt(query, top_match)

        results.append({
            "field": field,
            "query": query,
            "extracted_value": extracted_value,
            "similarity_score": score,
            "matched_text_snippet": top_match[:300] + "..."
        })

    return pd.DataFrame(results)
