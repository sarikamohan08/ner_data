import pandas as pd

# Function to check if a sheet contains the keywords
def contains_keywords(sheet, notice_keyword, service_keyword):
    # Flatten the sheet to search across all rows and columns
    sheet_flat = sheet.apply(lambda x: ' '.join(x.dropna().astype(str)), axis=1).str.lower()
    
    # Check for presence of any keyword
    contains_notice = sheet_flat.str.contains(notice_keyword, case=False).any()
    contains_service = sheet_flat.str.contains(service_keyword, case=False).any()
    
    return contains_notice or contains_service

# Function to concatenate all content of a sheet into one string
def sheet_to_single_cell(sheet):
    # Flatten the sheet content into one large string
    flattened_sheet = sheet.apply(lambda row: ' '.join(row.dropna().astype(str)), axis=1)
    return ' '.join(flattened_sheet)

# Load the Excel file
file_path = 'your_excel_file.xlsx'
xls = pd.ExcelFile(file_path)

# Keywords for filtering
notice_keyword = 'address for notice'
service_keyword = 'service address'

# List to store the results
extracted_sheets = []

# Loop through each sheet
for sheet_name in xls.sheet_names:
    sheet_df = pd.read_excel(xls, sheet_name=sheet_name)
    
    # Check if the sheet contains any of the keywords
    if contains_keywords(sheet_df, notice_keyword, service_keyword):
        # Convert the entire sheet content into a single cell (string)
        sheet_content = sheet_to_single_cell(sheet_df)
        
        # Append the sheet content and name to the results
        extracted_sheets.append({
            'Sheet Name': sheet_name,
            'Sheet Content': sheet_content
        })

# Convert the results to a DataFrame
if extracted_sheets:
    combined_df = pd.DataFrame(extracted_sheets)
    
    # Save the result to a new Excel file
    output_path = 'extracted_sheets_single_cell.xlsx'
    combined_df.to_excel(output_path, index=False)
    print(f'Extracted sheets saved to {output_path}')
else:
    print('No sheets contained the specified keywords.')
