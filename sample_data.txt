from llama_index import SimpleNodeParser, SimpleVectorIndex
from pymupdf4llm import Document as PDFDocument

def extract_text_from_pdf(pdf_path):
    """
    Extracts text from the PDF and returns it as a list of strings, one per page.
    """
    doc = PDFDocument(pdf_path)
    pages_text = [page.get_text() for page in doc]
    doc.close()
    return pages_text

def index_pdf_content(pages_text):
    """
    Takes a list of page texts and indexes them locally using SimpleVectorIndex.
    """
    # Initialize SimpleNodeParser to create nodes from each page's text
    parser = SimpleNodeParser()
    
    # Create nodes from each page's text
    nodes = [parser.create_node(page_text, metadata={"page": i}) for i, page_text in enumerate(pages_text)]
    
    # Initialize the SimpleVectorIndex to index the nodes locally without an API key
    index = SimpleVectorIndex(nodes)
    return index

def query_pdf_index(index, query_text):
    """
    Queries the indexed PDF content for the specified query text.
    """
    response = index.query(query_text)
    return response

# Define the path to your PDF file
pdf_path = "your_pdf_file.pdf"

# Step 1: Extract the PDF content
pages_text = extract_text_from_pdf(pdf_path)

# Step 2: Index the PDF content
index = index_pdf_content(pages_text)

# Step 3: Query the indexed content
query_text = "Explain the main concept of chapter 2"  # Sample query
response = query_pdf_index(index, query_text)

# Print the query response
print("Query Response:", response)
