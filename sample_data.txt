import pandas as pd

# Function to check if a sheet contains the keywords
def extract_keywords(sheet, notice_keyword, service_keyword):
    # Flatten the sheet content into a list of strings
    sheet_flat = sheet.apply(lambda x: ' '.join(x.dropna().astype(str)), axis=1).str.lower()

    # Extract notice address and service address if present
    notice_address = ' '.join(sheet_flat[sheet_flat.str.contains(notice_keyword, case=False)])
    service_address = ' '.join(sheet_flat[sheet_flat.str.contains(service_keyword, case=False)])

    return notice_address, service_address

# Function to concatenate all content of a sheet into one string
def sheet_to_single_cell(sheet):
    # Flatten the sheet content into one large string
    flattened_sheet = sheet.apply(lambda row: ' '.join(row.dropna().astype(str)), axis=1)
    return ' '.join(flattened_sheet)

# Load the Excel file
file_path = 'your_excel_file.xlsx'
xls = pd.ExcelFile(file_path)

# Keywords for filtering
notice_keyword = 'address for notice'
service_keyword = 'service address'

# List to store the results
extracted_sheets = []

# Loop through each sheet
for sheet_name in xls.sheet_names:
    sheet_df = pd.read_excel(xls, sheet_name=sheet_name)
    
    # Extract notice address and service address separately
    notice_address, service_address = extract_keywords(sheet_df, notice_keyword, service_keyword)
    
    # If either keyword is found, add the sheet data to the list
    if notice_address or service_address:
        extracted_sheets.append({
            'Sheet Name': sheet_name,
            'Notice Address': notice_address,
            'Service Address': service_address
        })

# Convert the results to a DataFrame
if extracted_sheets:
    combined_df = pd.DataFrame(extracted_sheets)
    
    # Save the result to a new Excel file
    output_path = 'extracted_notice_service_address.xlsx'
    combined_df.to_excel(output_path, index=False)
    print(f'Extracted sheets saved to {output_path}')
else:
    print('No sheets contained the specified keywords.')
