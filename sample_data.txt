import os
import pandas as pd

class FolderProcessor:
    def __init__(self, excel_path, root_folder_path, output_folder_path):
        """
        Initialize the FolderProcessor with paths.
        """
        self.excel_path = excel_path
        self.root_folder_path = root_folder_path
        self.output_folder_path = output_folder_path
        self.subfolders = self.load_subfolders()

    def load_subfolders(self):
        """
        Load the list of subfolders from the Excel file.
        """
        df = pd.read_excel(self.excel_path)
        return df.iloc[:, 0].tolist()  # Assuming subfolder names are in the first column

    def read_subfolder_files(self, subfolder_path):
        """
        Read all the files in the given subfolder and return their combined content.
        """
        subfolder_text_content = ""
        
        # Loop through each file in the subfolder
        for file_name in os.listdir(subfolder_path):
            file_path = os.path.join(subfolder_path, file_name)
            
            # Ensure it's a file and not a directory
            if os.path.isfile(file_path):
                with open(file_path, 'r', encoding='utf-8') as file:
                    subfolder_text_content += file.read() + "\n"  # Append file content
            
        return subfolder_text_content

    def save_subfolder_content(self, subfolder, content):
        """
        Save the content to the output folder as a .txt file.
        """
        output_file_path = os.path.join(self.output_folder_path, f"{subfolder}.txt")
        
        # Ensure the output folder exists
        if not os.path.exists(self.output_folder_path):
            os.makedirs(self.output_folder_path)
        
        # Save the content to a file
        with open(output_file_path, 'w', encoding='utf-8') as output_file:
            output_file.write(content)
        
        print(f"Saved content for subfolder: {subfolder}")

    def process_folders(self):
        """
        Process each subfolder: read its contents and save them.
        """
        for subfolder in self.subfolders:
            subfolder_path = os.path.join(self.root_folder_path, subfolder)
            
            # Check if the subfolder exists
            if os.path.exists(subfolder_path) and os.path.isdir(subfolder_path):
                print(f"Processing subfolder: {subfolder}")
                
                # Step 1: Read the contents of all files in the subfolder
                content = self.read_subfolder_files(subfolder_path)
                
                # Step 2: Save the combined content to the output folder
                self.save_subfolder_content(subfolder, content)
            else:
                print(f"Subfolder {subfolder} does not exist at {subfolder_path}")

# Example usage
if __name__ == "__main__":
    excel_path = "path_to_excel_file.xlsx"
    root_folder_path = "path_to_root_folder"
    output_folder_path = "path_to_output_folder"

    # Create an instance of FolderProcessor
    folder_processor = FolderProcessor(excel_path, root_folder_path, output_folder_path)
    
    # Start processing subfolders
    folder_processor.process_folders()
