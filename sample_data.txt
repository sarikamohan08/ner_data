from llama_index import VectorStoreIndex, SimpleDocument, ServiceContext
from pymupdf import fitz  # Make sure to install PyMuPDF as `pymupdf`

def extract_text_from_pdf(pdf_path):
    """
    Extracts text from the PDF and returns it as a list of strings, one per page.
    """
    pages_text = []
    with fitz.open(pdf_path) as doc:
        for page in doc:
            pages_text.append(page.get_text())
    return pages_text

def index_pdf_content(pages_text):
    """
    Takes a list of page texts and indexes them locally using VectorStoreIndex.
    """
    # Convert each page of text into SimpleDocument format
    documents = [SimpleDocument(text=page_text, metadata={"page": i}) for i, page_text in enumerate(pages_text)]
    
    # Create a ServiceContext for indexing
    service_context = ServiceContext.from_defaults()

    # Initialize the VectorStoreIndex to index the documents locally
    index = VectorStoreIndex(documents, service_context=service_context)
    return index

def query_pdf_index(index, query_text):
    """
    Queries the indexed PDF content for the specified query text.
    """
    response = index.query(query_text)
    return response

# Define the path to your PDF file
pdf_path = "your_pdf_file.pdf"

# Step 1: Extract the PDF content
