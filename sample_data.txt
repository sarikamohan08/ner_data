from llama_index import GPTSimpleVectorIndex
from pymupdf4llm import Document

def extract_text_from_pdf(pdf_path):
    """
    Extracts text from the PDF and returns it as a list of strings, one per page.
    """
    doc = Document(pdf_path)
    pages_text = [page.get_text() for page in doc]
    doc.close()
    return pages_text

def index_pdf_content(pages_text):
    """
    Takes a list of page texts and indexes them using LlamaIndex.
    """
    # Convert each page of text into a document format that LlamaIndex can process
    documents = [ {"text": page_text, "metadata": {"page": i}} for i, page_text in enumerate(pages_text)]
    
    # Initialize the index
    index = GPTSimpleVectorIndex.from_documents(documents)
    return index

def query_pdf_index(index, query_text):
    """
    Queries the indexed PDF content for the specified query text.
    """
    response = index.query(query_text)
    return response

# Define the path to your PDF file
pdf_path = "your_pdf_file.pdf"

# Step 1: Extract the PDF content
pages_text = extract_text_from_pdf(pdf_path)

# Step 2: Index the PDF content
index = index_pdf_content(pages_text)

# Step 3: Query the indexed content
query_text = "Explain the main concept of chapter 2"  # Sample query
response = query_pdf_index(index, query_text)

# Print the query response
print("Query Response:", response)
