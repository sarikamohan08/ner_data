import pandas as pd

# Function to search for addresses in the sheet content
def extract_address(sheet, keyword):
    address = ''
    for i, row in sheet.iterrows():
        row_str = ' '.join(row.dropna().astype(str)).strip().lower()
        # If we find the keyword in a row
        if keyword in row_str:
            # Try to extract the next row(s) as the address (assuming the address comes after the keyword)
            if i + 1 < len(sheet):
                next_row = ' '.join(sheet.iloc[i+1].dropna().astype(str)).strip()
                address = next_row
                break
    return address

# Load the Excel file
file_path = 'your_excel_file.xlsx'  # Replace with your file path
xls = pd.ExcelFile(file_path)

# Keywords for filtering
notice_keyword = 'notice address'
service_keyword = 'service address'

# List to store results
extracted_sheets = []

# Loop through each sheet
for sheet_name in xls.sheet_names:
    sheet_df = pd.read_excel(xls, sheet_name=sheet_name)
    
    # Extract notice address and service address
    notice_address = extract_address(sheet_df, notice_keyword)
    service_address = extract_address(sheet_df, service_keyword)
    
    # Only store if there's a valid address
    if notice_address or service_address:
        # Append the results
        extracted_sheets.append({
            'Sheet Name': sheet_name,
            'Notice Address': notice_address,
            'Service Address': service_address
        })

# Convert the results to a DataFrame
if extracted_sheets:
    combined_df = pd.DataFrame(extracted_sheets)
    
    # Save the result to a new Excel file
    output_path = 'extracted_addresses.xlsx'
    combined_df.to_excel(output_path, index=False)
    print(f'Extracted addresses saved to {output_path}')
else:
    print('No addresses found in the sheets.')
