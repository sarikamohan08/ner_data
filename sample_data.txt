from selenium import webdriver
from selenium.webdriver.edge.service import Service
from webdriver_manager.microsoft import EdgeChromiumDriverManager
from selenium.webdriver.common.by import By
from selenium.webdriver.edge.options import Options
import time

# Step 1: Setup Edge WebDriver with download configuration
download_dir = "/path/to/your/download/folder"  # Replace with your download folder path

options = Options()
options.add_argument("--disable-extensions")
options.add_argument("--headless")  # Optional: Run browser in headless mode
options.add_argument("--disable-gpu")
options.add_argument("--no-sandbox")

# Configure automatic download for Edge
prefs = {
    "download.default_directory": download_dir,
    "download.prompt_for_download": False,  # Don't show the prompt
    "download.directory_upgrade": True,
    "safebrowsing.enabled": True
}
options.add_experimental_option("prefs", prefs)

# Initialize the Edge WebDriver with options
driver = webdriver.Edge(service=Service(EdgeChromiumDriverManager().install()), options=options)
driver.get("https://example.com")  # Replace with your target URL

try:
    # Step 2: Wait for Export Button and Click
    export_button = WebDriverWait(driver, 10).until(
        EC.element_to_be_clickable((By.CLASS_NAME, "export_btn"))
    )
    export_button.click()

    # Step 3: Wait for the dropdown or modal with CSV option to appear
    # Replace this selector with the correct one for the dropdown or modal
    csv_option = WebDriverWait(driver, 10).until(
        EC.element_to_be_clickable((By.XPATH, "//li[text()='CSV for Excel']"))  # Adjust this XPATH as needed
    )
    csv_option.click()

    # Step 4: Wait for the file to download (Adjust the sleep time based on the download speed)
    time.sleep(5)  # Adjust based on the actual time it takes for the file to download

except Exception as e:
    print(f"Error: {e}")

# Step 5: Quit Driver
driver.quit()
