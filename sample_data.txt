import openai
import pandas as pd
import json

openai.api_key = "YOUR_API_KEY"

document_text = """
<your full document text with paragraphs and [PAGE_BREAK] markers>
"""

prompt = f"""
You are a document parser.

The document pages are separated by "[PAGE_BREAK]".

Number all paragraphs sequentially from 1.

Extract the following three paragraphs labeled para1, para2 and para3 from the text.

For each paragraph, provide its text, paragraph index (number), and the page number (starting at 1).

Return strictly in JSON format:

{{
  "para1": {{"text": "...", "index": 3, "page": 1}},
  "para2": {{"text": "...", "index": 8, "page": 2}},
  "para3": {{"text": "...", "index": 15, "page": 3}}
}}

Document text:

{document_text}

Only give the JSON response, no explanations.
"""

response = openai.ChatCompletion.create(
    model="gpt-4",
    messages=[{"role": "system", "content": "You are a helpful assistant."},
              {"role": "user", "content": prompt}],
    temperature=0,
)

response_text = response['choices'][0]['message']['content']
data = json.loads(response_text)

# Transform JSON into single row with flat columns
flat_data = {}
for key, val in data.items():
    flat_data[key] = val['text']
    flat_data[f"{key}_ind"] = val['index']
    flat_data[f"{key}_page"] = val['page']

df = pd.DataFrame([flat_data])

print(df)
