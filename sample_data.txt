import pytesseract
from pdf2image import convert_from_path
import os

# Specify the path to the Tesseract OCR executable
pytesseract.pytesseract.tesseract_cmd = r'C:\Program Files\Tesseract-OCR\tesseract.exe'  # Update this path if necessary

def process_pdf_with_tesseract(file_path, output_path):
    try:
        # Convert the first page of the PDF to an image
        images = convert_from_path(file_path, first_page=1, last_page=1)
        
        if not images:
            print(f"No pages found in the PDF: {file_path}")
            return
        
        # Use pytesseract to extract text from the first page
        text = pytesseract.image_to_string(images[0])
        
        # Check for the specific phrase
        if "Amendment to the agreement between HCA" in text:
            # Save the text to the output file
            with open(output_path, 'w', encoding='utf-8') as output_file:
                output_file.write(text)
            print(f"Text extracted and saved to {output_path}")
        else:
            print(f"The phrase was not found in the file: {file_path}")
    
    except Exception as e:
        print(f"An error occurred while processing {file_path}: {e}")

def process_folder(input_folder, output_folder):
    # Ensure output folder exists
    os.makedirs(output_folder, exist_ok=True)
    
    # Loop through all files in the input folder
    for file_name in os.listdir(input_folder):
        if file_name.endswith('.pdf'):  # Process only PDF files
            input_file_path = os.path.join(input_folder, file_name)
            output_file_path = os.path.join(output_folder, f"{os.path.splitext(file_name)[0]}_output.txt")
            print(f"Processing file: {file_name}")
            process_pdf_with_tesseract(input_file_path, output_file_path)

# Input and output folder paths
input_folder_path = "path_to_your_input_folder"  # Replace with the path to your folder containing PDFs
output_folder_path = "path_to_your_output_folder"  # Replace with the path to save output files

# Process all PDFs in the folder
process_folder(input_folder_path, output_folder_path)

