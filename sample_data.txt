prompt = """You will receive a text containing various healthcare services levels and types, including Skilled Nursing Facility Levels 1–4, covered services and Inpatient/Outpatient services.
If there are multiple providers in the document (provider name, effective date, NPI, tax ID), add only the first occurrence. For each service, extract the following fields:
PROVIDER NAME: the name of the provider
EFFECTIVE FROM DATE: the effective date of the document or coverage
NPI: the provider's NPI identification number
TAX ID: the provider's tax identification number
Additionally, scan all narrative text, sentences, and paragraphs for any mention of services matching 'Covered Services rendered', 'Covered Services not listed', 'Covered Services provided', or similar phrases, even if embedded within sentences containing reimbursement percentages and codes. For example:
Provider agrees to accept as payment in full from Humana for Covered Services rendered to Members, ninety percent (90%) of Humana's (885-270) Fee Schedule.
Sample covered services scenarios:
(1) Provider agrees to accept as payment in full from Humana for Covered Services rendered to Members, sixty-five percent (65%) of Humana's (005-335) fee schedule, or Provider's billed charges, whichever is less, less any Copayments due from Members.
Here service: 'Covered Services', code: (805-335), REIMBURSEMENT RATE: 65%, REIMBURSEMENT METHODOLOGY: fee schedule. Example services include 'Level 1', 'Drugs & Biologicals', 'All other services', 'Covered Services rendered', 'Covered Services not listed', 'Covered Services provided', 'Long term care days', 'Home leave days', 'Hospital leave days', 'SNF Level services', 'Services covered outside of Per Diem'.
(2) For any Covered Services not listed in Humana's (005-270) Fee Schedule, Provider agrees to accept as payment in full, fifty-eight percent (58%) of Provider's usual and customary charges, less any Copayment due from Member.
Here service: 'Covered Services not listed', code: (805-278), REIMBURSEMENT RATE: 58%, REIMBURSEMENT METHODOLOGY: fee schedule. Example services include 'Level 1', 'Drugs & Biologicals', 'All other services', 'Covered Services rendered', 'Covered Services not listed', 'Covered Services provided', 'Long term care days', 'Home leave days', 'Hospital leave days', 'SNF Level services', 'Services covered outside of Per Diem'.
(3) Sample Medicaid or Medicare Dual Eligible services scenario: extract the whole table below the text 'Medicaid or Medicare Dual Eligible'.
Revenue Code | Reimbursement Method | Reimbursement
101 | Long-Term Care Days | 100% Medicaid Allowable
182 | Home leave Days (Therapeutic leave days) | 100% Medicaid Allowable
185 | Hospital leave Days | 100% Medicaid Allowable
Extract this kind of table with columns: Service (from the reimbursement method column), Code (from the revenue code column, e.g., 101, 182, 185), REIMBURSEMENT RATE: 100%, REIMBURSEMENT METHODOLOGY: Medicaid Allowable.
(4) Sample Skilled Nursing Facility Services Reimbursement scenario: extract the whole table below the section 'Skilled Nursing Facility Services Reimbursement'.
Revenue Code | Reimbursement Method | Reimbursement
191 | Per Diem | 100% Medicaid Facility
421 | Per Diem | $65.00 per PT discipline per day
431 | Per Diem | $65.00 per OT discipline per day
441 | Per Diem | $65.00 per ST discipline per day
Example output: service - Skilled Nursing Facility Services (same for all rows), codes: 191, 421, 431, 441, REIMBURSEMENT AMOUNT: $65.00, REIMBURSEMENT RATE: 100%, REIMBURSEMENT METHODOLOGY: Per Diem.
For each such service mention, extract a record with the following fields:
SERVICE TYPE: the category or type of service (e.g., 'inpatient', 'outpatient'); if it’s inpatient part B then mark as outpatient
REIMBURSEMENT AMT: reimbursement value in dollars (integer) if available, or reimbursement rate as a percentage string
REIMBURSEMENT RATE: reimbursement rate as a percentage string if available (include only the rate)
SERVICE DESC: detailed descriptions related to each service level
CODES: revenue code string, fee schedule string, or any numeric/alphanumeric code extracted from the fee schedule (include only codes, not descriptions)
REVENUE CD IND: 1 if text contains revenue code, else 0
DRG_CD_IND: 1 if text contains MS-DRG code, else 0
CPT_IND: 1 if text contains CPT code, else 0
HCPCS_IND: 1 if text contains HCPCS code, else 0
ICD_CD_IND: 1 if text contains ICD code, else 0
DIAGNOSIS_CD_IND: 1 if text contains Diagnosis code, else 0
MODIFIER_CD_IND: 1 if text contains Modifier code, else 0
LOB IND: extract line of business ('Medicare', 'Medicaid', 'Commercial'); if multiple, list all comma-separated
REIMBURSEMENT METHODOLOGY: one of ['Per Diem', 'Per procedure', 'Per visit', 'Per case', 'Percent of charge', 'Medicare allowable amount', 'Fee schedule', 'Percent of line charge', 'POC']
METHOD OF PAYMENT: the code string (e.g., 'no1', 'po3') exactly as found in text
MOP Code Explanation Table:
no1: the allowed amount is the contracted rate, regardless of the charge
no2: the allowed amount is the lesser of the contracted rate or the percent of total eligible billed charges
po3: the allowed amount is either the contracted rate or greater of percent of total eligible billed charges
no4: the allowed amount is either the contracted rate or total eligible billed charges, whichever is greater
AGE GROUP: 1 if the phrase 'Age group' appears anywhere in the text, else 0
GROUPER IND: 1 if 'grouper' appears anywhere, else 0
GROUPER: extract grouper details if present
APC IND: 1 if 'APC' appears anywhere, else 0
MSR IND: 1 if 'Multiple Surgery Logic' appears anywhere, else 0
BILATERAL PROCEDURE IND: 1 if 'bilateral procedures' appears anywhere, else 0
PROVIDER SPECIALITY: 1 if 'provider specialty' appears anywhere, else 0
EXCLUDE FROM TRANSFER IND: 1 if 'transfer' appears in the section, else 0
TRANSFER CALCULATION: extract formula text if 'transfer' or similar calculation terms appear (e.g., 'DRG Payment/Arithmetic LOS x inpatient days')
EXCLUDE FROM STOPLOSS IND: 1 if 'stop loss threshold' appears, else 0
OTHER FLAT FEE: 1 if 'flat fee' appears, else 0
SURG FLAT FEE: 1 if 'flat surgical fee' or 'surgical fee' appears, else 0
CASE RATE: extract any text mentioning 'case rate' with duration in days if present
HEALTH BENEFIT PLANS: extract any health benefit plan information present in tables
Output only valid Python code assigning a single list of dictionaries to the variable 'combined_data'."""
