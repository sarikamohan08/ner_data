import os
import pytesseract
from pdf2image import convert_from_path
import pandas as pd
from PIL import Image

# Configure Tesseract path if necessary
# pytesseract.pytesseract.tesseract_cmd = r'/path/to/tesseract'

# Folder containing PDF files
input_folder = "/path/to/pdf/folder"

# Initialize an empty DataFrame to store results
results = []

# Iterate over all PDF files in the folder
for file_name in os.listdir(input_folder):
    if file_name.endswith('.pdf'):
        file_path = os.path.join(input_folder, file_name)
        
        # Convert PDF pages to images
        images = convert_from_path(file_path)
        
        # Process each page of the PDF
        for page_num, image in enumerate(images, start=1):
            # OCR on the page image
            ocr_result = pytesseract.image_to_data(image, output_type=pytesseract.Output.DICT)
            
            for i in range(len(ocr_result['text'])):
                text = ocr_result['text'][i]
                conf = int(ocr_result['conf'][i])
                
                # Only consider non-empty text
                if text.strip():
                    # Determine handwritten or not
                    classification = "handwritten" if 10 <= conf <= 30 else "not handwritten"
                    
                    # Append result to the list
                    results.append({
                        "File Name": file_name,
                        "Page Number": page_num,
                        "Original Text": text,
                        "Confidence": conf,
                        "Classification": classification
                    })

# Convert results to a DataFrame
df_results = pd.DataFrame(results)

# Save the final DataFrame as a CSV or print it
output_file = "ocr_results.csv"
df_results.to_csv(output_file, index=False)
print(df_results)
