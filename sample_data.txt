from pdf2image import convert_from_path
import pytesseract
import cv2

def preprocess_image(image):
    # Convert the image to grayscale
    gray = cv2.cvtColor(image, cv2.COLOR_BGR2GRAY)

    # Apply thresholding to get a binary image
    _, binary = cv2.threshold(gray, 150, 255, cv2.THRESH_BINARY | cv2.THRESH_OTSU)

    # Optional: Apply additional preprocessing (e.g., noise removal, dilation)
    # binary = cv2.medianBlur(binary, 3)  # Noise removal
    # kernel = cv2.getStructuringElement(cv2.MORPH_RECT, (3, 3))
    # binary = cv2.dilate(binary, kernel, iterations=1)  # Dilation

    return binary

def extract_text_from_scanned_pdf(pdf_path):
    # Convert PDF pages to images
    images = convert_from_path(pdf_path)

    # Extract text from each image using Tesseract
    extracted_text = ""
    for image in images:
        # Convert PIL image to OpenCV format (numpy array)
        opencv_image = cv2.cvtColor(np.array(image), cv2.COLOR_RGB2BGR)

        # Preprocess the image
        processed_image = preprocess_image(opencv_image)

        # Extract text from the processed image
        text = pytesseract.image_to_string(processed_image, lang='eng')  # Use 'eng' for English
        extracted_text += text + "\n"

    return extracted_text

# Path to your scanned PDF
pdf_path = "scanned_document.pdf"

# Extract text
text = extract_text_from_scanned_pdf(pdf_path)
print(text)
