import pandas as pd

# Function to check if a sheet contains the keywords
def contains_keywords(sheet, notice_keyword, service_keyword):
    # Flatten the sheet to search across all rows and columns
    sheet_flat = sheet.apply(lambda x: ' '.join(x.dropna().astype(str)), axis=1).str.lower()
    
    # Check for presence of any keyword
    contains_notice = sheet_flat.str.contains(notice_keyword, case=False).any()
    contains_service = sheet_flat.str.contains(service_keyword, case=False).any()
    
    return contains_notice or contains_service

# Load the Excel file
file_path = 'your_excel_file.xlsx'
xls = pd.ExcelFile(file_path)

# Keywords for filtering
notice_keyword = 'address for notice'
service_keyword = 'service address'

# DataFrame to store results
extracted_sheets = []

# Loop through each sheet
for sheet_name in xls.sheet_names:
    sheet_df = pd.read_excel(xls, sheet_name=sheet_name)
    
    # Check if sheet contains any of the keywords
    if contains_keywords(sheet_df, notice_keyword, service_keyword):
        # Append the sheet with an additional column indicating sheet name
        sheet_df['Sheet Name'] = sheet_name
        extracted_sheets.append(sheet_df)

# Combine all extracted sheets
if extracted_sheets:
    combined_df = pd.concat(extracted_sheets, ignore_index=True)
    
    # Save the result to a new Excel file
    output_path = 'extracted_sheets.xlsx'
    combined_df.to_excel(output_path, index=False)
    print(f'Extracted sheets saved to {output_path}')
else:
    print('No sheets contained the specified keywords.')
